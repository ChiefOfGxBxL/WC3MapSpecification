# Map Information Format

This file contains most map settings.
Some values like `Map name` can be set from map code, others are initialized by the game during loading.

Strings may support `TRIGSTR_` placeholders to be loaded from localizable `war3map.wts`.

`IF ( CURRENT > VERSION ) ... ENDIF` means the inner block only exists if the file matches the format version.
This is meant to make it easy to support old format versions.

| Type                                               | Description                                                | Explanation                                                                                                                      |
| -------------------------------------------------- | ---------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------- |
| int                                                | Format version                                             | ROC=18, TFT=25, 1.32=31; see „Version History“                                                                                   |
| IF( Format >= 16)                                  |                                                            |                                                                                                                                  |
| int                                                | Number of saves                                            |                                                                                                                                  |
| int                                                | WorldEditor version                                        |                                                                                                                                  |
| ENDIF                                              |                                                            |                                                                                                                                  |
|                                                    |                                                            |                                                                                                                                  |
| IF( Format >= 27 )                                 |                                                            |                                                                                                                                  |
| int                                                | Game version major: A                                      |                                                                                                                                  |
| int                                                | Game version minor: B                                      |                                                                                                                                  |
| int                                                | Game version patch: C                                      |                                                                                                                                  |
| int                                                | Game version build: D                                      | Example: A.B.C.D = 1.31.1.12173                                                                                                  |
| ENDIF                                              |                                                            |                                                                                                                                  |
|                                                    |                                                            |                                                                                                                                  |
| string_max(109)                                    | Map name                                                   | Note: based on game version the name will be pulled from here, HM3W header or config() in script file.<br/>Accepts `TRIGSTR_`    |
| string_max(97)                                     | Map author                                                 |                                                                                                                                  |
| string_max(769)                                    | Map description                                            |                                                                                                                                  |
| IF( Format >= 8 )                                  |                                                            |                                                                                                                                  |
| string_max(49)                                     | Recommended players                                        |                                                                                                                                  |
| ENDIF                                              |                                                            |                                                                                                                                  |
|                                                    |                                                            |                                                                                                                                  |
| IF( Format <= 3 )                                  |                                                            |                                                                                                                                  |
| `unknown(4)`                                       | unknown_v0_unk1                                            | Ignored by new versions                                                                                                          |
| `unknown(4)`                                       | unknown_v0_unk2                                            | Ignored by new versions                                                                                                          |
| ELSEIF( Format <= 8 )                              |                                                            |                                                                                                                                  |
| float                                              | unknown_v4_float1                                          | Ignored by new versions, only observed 6                                                                                         |
| int                                                | unknown_v4_int1                                            | Ignored by new versions, only observed 1                                                                                         |
| float                                              | unknown_v4_float2                                          | Ignored by new versions, only observed 24                                                                                        |
| float                                              | unknown_v4_float3                                          | Ignored by new versions, only observed 6                                                                                         |
| float                                              | unknown_v4_float4                                          | Ignored by new versions, only observed 18                                                                                        |
| int                                                | unknown_v4_int2                                            | Ignored by new versions, only observed 480                                                                                       |
| ENDIF                                              |                                                            |                                                                                                                                  |
|                                                    |                                                            |                                                                                                                                  |
| `float[8]`                                         | Camera bounds                                              | Left, bottom, right, top; Left, top, right, bottom                                                                               |
| IF( Format >= 14 )                                 |                                                            |                                                                                                                                  |
| `int[4]`                                           | Size of map's unplayable area                              | Variables A, B, C, D. See below                                                                                                  |
| ENDIF                                              |                                                            |                                                                                                                                  |
|                                                    |                                                            |                                                                                                                                  |
| IF( Format >= 1)                                   |                                                            |                                                                                                                                  |
| int                                                | Width of playable map area                                 | E, map width = A+E+B                                                                                                             |
| int                                                | Height of playable map area                                | F, map height = C+F+D                                                                                                            |
| ENDIF                                              |                                                            |                                                                                                                                  |
|                                                    |                                                            |                                                                                                                                  |
| IF( Format >= 2 )                                  |                                                            |                                                                                                                                  |
|   IF( Format <= 8)                                 |                                                            |                                                                                                                                  |
| int                                                | unknown_v3_int1                                            | Ignored by new versions                                                                                                          |
|   ENDIF                                            |                                                            |                                                                                                                                  |
| int                                                | Map flags                                                  | See Map flags; if Format <= 14: enable the flag „Show water waves on cliff shores“                                               |
| ENDIF                                              |                                                            |                                                                                                                                  |
|                                                    |                                                            |                                                                                                                                  |
| IF( Format >= 8 )                                  |                                                            |                                                                                                                                  |
| char                                               | Terrain: main tile type                                    | Example: 'A' - Ashenvale, 'L' - Summer Lordaeron                                                                                 |
| ENDIF                                              |                                                            |                                                                                                                                  |
|                                                    |                                                            |                                                                                                                                  |
| IF( Format >= 17 )                                 |                                                            |                                                                                                                                  |
| int                                                | Number of loading screen background for standard campaigns | -1 = none or an imported loading screen is used                                                                                  |
| ENDIF                                              |                                                            |                                                                                                                                  |
|                                                    |                                                            |                                                                                                                                  |
| IF( Format >= 10 && Format != 18 && Format != 19 ) |                                                            | Note: for (10 <= FORMAT <= 17) the game stores this path in a different location, implying it might have had a different meaning |
| string_max(260)                                    | Imported loading screen path                               |                                                                                                                                  |
| ENDIF                                              |                                                            |                                                                                                                                  |
|                                                    |                                                            |                                                                                                                                  |
| IF( Format >= 10 )                                 |                                                            |                                                                                                                                  |
| string_max(6145)                                   | Loading screen text                                        |                                                                                                                                  |
|    IF( Format >= 11 )                              |                                                            |                                                                                                                                  |
| string_max(97)                                     | Loading screen title                                       |                                                                                                                                  |
| string_max(145)                                    | Loading screen subtitle                                    |                                                                                                                                  |
|    ENDIF                                           |                                                            |                                                                                                                                  |
| ENDIF                                              |                                                            |                                                                                                                                  |
|                                                    |                                                            |                                                                                                                                  |
| IF( Format >= 17 )                                 |                                                            |                                                                                                                                  |
| int                                                | Use game data set version                                  | 0 = Default (based on map melee status),  1 = Custom (1.01), 2 = Melee (latest patch). Set to INT_MAX in v26 ROC, not v26 TFT    |
| ENDIF                                              |                                                            |                                                                                                                                  |
|                                                    |                                                            |                                                                                                                                  |
| IF( Format >= 13 && Format != 18 && Format != 19 ) |                                                            |                                                                                                                                  |
|    IF( Format <= 17 )                              |                                                            |                                                                                                                                  |
| string_max(260)                                    | Unknown meaning of path                                    |                                                                                                                                  |
|    ELSE                                            |                                                            | i.e. if Format >= 20, same string is used as prologue path                                                                       |
| string_max(260)                                    | Imported loading screen path for prologue                  |                                                                                                                                  |
|    ENDIF                                           |                                                            |                                                                                                                                  |
| ENDIF                                              |                                                            |                                                                                                                                  |
|                                                    |                                                            |                                                                                                                                  |
| IF( Format >= 13 )                                 |                                                            |                                                                                                                                  |
| string_max(6145)                                   | Prologue screen text                                       |                                                                                                                                  |
| string_max(97)                                     | Prologue screen title                                      |                                                                                                                                  |
| string_max(145)                                    | Prologue screen subtitle                                   |                                                                                                                                  |
| ENDIF                                              |                                                            |                                                                                                                                  |
|                                                    |                                                            |                                                                                                                                  |
| IF( Format >= 19 )                                 |                                                            |                                                                                                                                  |
| int                                                | Ambient fog type                                           | 0=Not enabled, above zero = number in fog style list (confirmation?)                                                             |
| float                                              | Fog start height (Z-axis)                                  |                                                                                                                                  |
| float                                              | Fog end height (Z-axis)                                    |                                                                                                                                  |
| float                                              | Fog density                                                |                                                                                                                                  |
| byte                                               | Fog color R                                                | Red                                                                                                                              |
| byte                                               | Fog color G                                                | Green                                                                                                                            |
| byte                                               | Fog color B                                                | Blue                                                                                                                             |
| byte                                               | Fog color A                                                | Transparency (Alpha)                                                                                                             |
| ENDIF                                              |                                                            |                                                                                                                                  |
|                                                    |                                                            |                                                                                                                                  |
| IF( Format >= 21 )                                 |                                                            |                                                                                                                                  |
| `char[4]`                                          | Global weather rawcode ID                                  | 0=none                                                                                                                           |
| ENDIF                                              |                                                            |                                                                                                                                  |
|                                                    |                                                            |                                                                                                                                  |
| IF( Format >= 22 )                                 |                                                            |                                                                                                                                  |
| string_max(32)                                     | Custom sound environment                                   |                                                                                                                                  |
| ENDIF                                              |                                                            |                                                                                                                                  |
|                                                    |                                                            |                                                                                                                                  |
| IF( Format >= 23 )                                 |                                                            |                                                                                                                                  |
| char                                               | Custom light environment                                   | Example: 'A' - Ashenvale, 'L' - Summer Lordaeron                                                                                 |
| ENDIF                                              |                                                            |                                                                                                                                  |
|                                                    |                                                            |                                                                                                                                  |
| IF( Format >= 25 )                                 |                                                            |                                                                                                                                  |
| byte                                               | Water tint color R                                         | Red                                                                                                                              |
| byte                                               | Water tint color G                                         | Green                                                                                                                            |
| byte                                               | Water tint color B                                         | Blue                                                                                                                             |
| byte                                               | Water tint color A                                         | Transparency (Alpha)                                                                                                             |
| ENDIF                                              |                                                            |                                                                                                                                  |
|                                                    |                                                            |                                                                                                                                  |
| IF( Format >= 28 )                                 |                                                            |                                                                                                                                  |
| int                                                | Scripting language                                         | 0=JASS, 1=Lua                                                                                                                    |
| ENDIF                                              |                                                            |                                                                                                                                  |
|                                                    |                                                            |                                                                                                                                  |
| IF( Format >= 29 )                                 |                                                            |                                                                                                                                  |
| int                                                | Supported graphics modes                                   | 1=SD, 2=HD, 3=SD+HD                                                                                                              |
| ENDIF                                              |                                                            |                                                                                                                                  |
|                                                    |                                                            |                                                                                                                                  |
| IF( Format >= 30 )                                 |                                                            |                                                                                                                                  |
| int                                                | Game data version                                          | 0=ROC, 1=TFT                                                                                                                     |
| ENDIF                                              |                                                            |                                                                                                                                  |
|                                                    |                                                            |                                                                                                                                  |
| IF( TRAILING_LEVEL >= 1 )                          |                                                            | It’s an outside condition, can be detected by checking for EOF                                                                   |
| int                                                | Number of players                                          | Variable i                                                                                                                       |
|                                                    | repeat i times, see Player Data                            |                                                                                                                                  |
| ENDIF                                              |                                                            |                                                                                                                                  |
|                                                    |                                                            |                                                                                                                                  |
| IF( TRAILING_LEVEL >= 2 )                          |                                                            | It’s an outside condition, can be detected by checking for EOF                                                                   |
| IF( Format >= 3 )                                  |                                                            | // Needs confirmation, TODO                                                                                                      |
| int                                                | Number of teams (forces)                                   | Variable i                                                                                                                       |
|                                                    | repeat i times, see Team Data                              |                                                                                                                                  |
| ENDIF                                              |                                                            |                                                                                                                                  |
| ENDIF                                              |                                                            |                                                                                                                                  |
|                                                    |                                                            |                                                                                                                                  |
| IF( TRAILING_LEVEL >= 3 )                          |                                                            | It’s an outside condition, can be detected by checking for EOF                                                                   |
| IF( Format >= 6 )                                  |                                                            |                                                                                                                                  |
| int                                                | Number of Custom Upgrades                                  | Variable i                                                                                                                       |
|                                                    | repeat i times, see Custom Upgrade Data                    |                                                                                                                                  |
| ENDIF                                              |                                                            |                                                                                                                                  |
|                                                    |                                                            |                                                                                                                                  |
| IF( Format >= 7 )                                  |                                                            |                                                                                                                                  |
| int                                                | Number of Custom Tech                                      | Variable i                                                                                                                       |
|                                                    | repeat i times, see Custom Tech Data                       |                                                                                                                                  |
| ENDIF                                              |                                                            |                                                                                                                                  |
|                                                    |                                                            |                                                                                                                                  |
| IF( Format >= 12 )                                 |                                                            |                                                                                                                                  |
| int                                                | Number of Random Unit Tables (groups)                      | Variable i                                                                                                                       |
|                                                    | repeat i times, see Random Unit Table Data                 |                                                                                                                                  |
| ENDIF                                              |                                                            |                                                                                                                                  |
|                                                    |                                                            |                                                                                                                                  |
| IF( Format >= 24 )                                 |                                                            |                                                                                                                                  |
| int                                                | Number of Random Item Tables                               | Variable i                                                                                                                       |
|                                                    | repeat i times, see Item Table Data                        |                                                                                                                                  |
| ENDIF                                              |                                                            |                                                                                                                                  |
|                                                    |                                                            |                                                                                                                                  |
| IF( Format == 26 \|\| Format == 27 )               |                                                            |                                                                                                                                  |
| int                                                | Scripting language                                         | Not used or available in public versions. See „Scripting language“ above                                                         |
| ENDIF                                              |                                                            |                                                                                                                                  |
| ENDIF                                              |                                                            | End of TRAILING_LEVEL 3                                                                                                          |


## Map Flags

| Map flags      | Description                                                                                                      |
| -------------- | ---------------------------------------------------------------------------------------------------------------- |
| 0x000001       | Hide minimap on preview screens                                                                                  |
| 0x000002       | Change ally priorities                                                                                           |
| 0x000004       | Map is suitable for „Melee“ mode                                                                                 |
| 0x000008       | Use non-default terrain tileset / HiveWE: „playable map size was large and has never been reduced to medium (?)“ |
| 0x000010       | Masked (unexplored) areas are partially visible (fog of war)                                                     |
| 0x000020       | Fixed player parameters for custom teams                                                                         |
| 0x000040       | Uses custom teams                                                                                                |
| 0x000080       | Uses custom tech tree                                                                                            |
| 0x000100       | Uses custom abilities                                                                                            |
| 0x000200       | Uses custom upgrades                                                                                             |
| 0x000400       | Map properties menu opened at least once since map creation                                                      |
| 0x000800       | Show water waves on cliff shores                                                                                 |
| 0x001000       | Show water waves on rolling shores                                                                               |
| IF( TFT )      |                                                                                                                  |
| 0x002000       | Use terrain fog                                                                                                  |
| 0x004000       | Expansion required (TFT)                                                                                         |
| 0x008000       | Item classification                                                                                              |
| 0x010000       | Changes water tint color                                                                                         |
| ENDIF          |                                                                                                                  |
| IF( REFORGED ) |                                                                                                                  |
| 0x020000       | Use accurate probability for calculations                                                                        |
| 0x040000       | Custom Ability Skins (?)                                                                                         |
| ENDIF          |                                                                                                                  |
| 0x20000000     | Unkown or unused                                                                                                 |
| 0x40000000     | Unkown or unused                                                                                                 |

## Player Data

| Type               | Description                     | Explanation                                                                        |
| ------------------ | ------------------------------- | ---------------------------------------------------------------------------------- |
| int                | Player slot number              | Zero-based                                                                         |
| int                | Player type (slot)              | 1=Human, 2=Computer, 3=Neutral, 4=Reserved                                         |
| int                | Player race                     | 0=Random, 1=Human, 2=Orc, 3=Undead, 4=Night elves                                  |
| int                | Fixed spawn position            | 0x1 bit: 0=no, 1=yes                                                               |
| string             | Player name                     | Reads arbitrary length, then truncates input to max. 96 bytes (care UTF-8!)        |
| float              | Spawn position X map coordinate |                                                                                    |
| float              | Spawn position Y map coordinate |                                                                                    |
| IF ( Format >= 5 ) |                                 |                                                                                    |
| int                | Ally low priority (bitmap)      | From lowest to highest bit (0=player ID has no priority, 1=player ID has priority) |
| int                | Ally high priority (bitmap)     | Same as above                                                                      |
| ENDIF              |                                 |                                                                                    |
| IF( Format >= 31 ) |                                 |                                                                                    |
| int                | Enemy low priority (bitmap)     | From lowest to highest bit (0=player ID has no priority, 1=player ID has priority) |
| int                | Enemy high priority (bitmap)    | Same as above                                                                      |
| ENDIF              |                                 |                                                                                    |

## Team Data

| Type   | Description | Explanation                                                                                                                                                                                                                              |
| ------ | ----------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| int    | Flags       | See team flag bitmap                                                                                                                                                                                                                     |
| int    | Players     | From lowest bit to highest. (0=Player not in team, 1=Player in team), but you must consider the presence of player in the game, because the first team contains all players by default (slots 0 to 31), who are not part of other teams. |
| string | Team name   | Reads arbitrary length, then truncates input to max. 96 bytes (care UTF-8!)                                                                                                                                                              |

## Team Flags

| Bit flags | Description                  |
| --------- | ---------------------------- |
| 0x0001    | Ally                         |
| 0x0002    | Share victory                |
| 0x0004    | Unknown                      |
| 0x0008    | Share visibility             |
| 0x0010    | Share control                |
| 0x0020    | Share control advanced (all) |

## Custom Upgrades

| Custom upgrades | Description        | Explanation                                                                                    |
| --------------- | ------------------ | ---------------------------------------------------------------------------------------------- |
| int             | Players (bitmap)   | From lowest to highest bit: 0=upgrade does not apply to player, 1=upgrade does apply to player |
| `char[4]`       | Upgrade rawcode ID |                                                                                                |
| int             | Upgrade level      |                                                                                                |
| int             | Upgrade available  | 0=Not available, 1=Available, 2=Researched                                                     |

## Custom Tech

| Type      | Description      | Explanation                                                                              |
| --------- | ---------------- | ---------------------------------------------------------------------------------------- |
| int       | Players (bitmap) | From lowest to highest bit: (0=Tech AVAILABLE for player, 1=Tech UNAVAILABLE for player) |
| `char[4]` | Tech rawcode ID  | It can be one of: item, unit, ability                                                    |

## Random Unit Tables

| Type     | Description                  | Explanation                                                                 |
| -------- | ---------------------------- | --------------------------------------------------------------------------- |
| int      | This group's number          |                                                                             |
| string   | Group name                   | Reads arbitrary length, then truncates input to max. 99 bytes (care UTF-8!) |
| int      | Number of elements (columns) | Variable j                                                                  |
| `int[j]` | Element type                 | 0=Unit, 1=Building, 2=Item                                                  |
| int      | Number of rows               | Variable k                                                                  |
|          | repeat k times:              |                                                                             |
|          | int                          | Chance (in percent)                                                         |
|          | `char[j*4]`                  | Rawcode IDs (unit/building/item)                                            |

## Random Item Tables

| Type   | Description                  | Explanation                                                                 |                     |
| ------ | ---------------------------- | --------------------------------------------------------------------------- | ------------------- |
| int    | Table number                 |                                                                             |                     |
| string | Table name                   | Reads arbitrary length, then truncates input to max. 99 bytes (care UTF-8!) |                     |
| int    | Number of item sets in table | Variable j                                                                  |                     |
|        | repeat j times:              |                                                                             |                     |
|        | int                          | Amount of items in set:                                                     | Variable k          |
|        |                              | repeat k times:                                                             |                     |
|        |                              | int                                                                         | Chance (in percent) |
|        |                              | `char[4]`                                                                   | Item rawcode ID     |

## Version History

| W3I Version | Known Patch                                   | Description                                                                                            |
| ----------- | --------------------------------------------- | ------------------------------------------------------------------------------------------------------ |
| 0           |                                               |                                                                                                        |
| 1           |                                               | Added playable map width/height                                                                        |
| 2           |                                               | Added map flags                                                                                        |
| 3           |                                               |                                                                                                        |
| 4           |                                               | Added unknown values before camera bounds                                                              |
| 5           |                                               | Added player ally priority low/high                                                                    |
| 6           |                                               | Added: custom upgrades                                                                                 |
| 7           |                                               | Added: custom tech                                                                                     |
| 8           | Beta ROC 100, 103, 110                        | Added: recommended players                                                                             |
| 9           |                                               | Removed unknowns before camera bounds present in 8 and earlier. Removed int before map flags           |
| 10          | Beta ROC 111, 112                             | Added loading screen text                                                                              |
| 11          | Beta ROC 112                                  | Added loading screen title, subtitle                                                                   |
| 12          |                                               | Added random unit tables                                                                               |
| 13          |                                               | Added prologue screen texts                                                                            |
| 14          |                                               | Added size of map's unplayable area                                                                    |
| 15          | Beta ROC 120                                  | war3map.wts format introduced after v11, present in v15                                                |
| 16          | ?                                             | Added WE version and map saves number                                                                  |
| 17          |                                               | Added loading screen number for campaign and game data set version                                     |
| 18          | ROC Retail                                    | Temporarily removed custom loading screen background images                                            |
| 19          |                                               | Added ambient fog                                                                                      |
| 20          |                                               | Reintroduced custom loading screen background images                                                   |
| 21          |                                               | Added global weather rawcode id                                                                        |
| 22          |                                               | Added custom sound env                                                                                 |
| 23          | Beta TFT 299                                  | Added custom light env                                                                                 |
| 24          | Beta TFT 304                                  | Added random item tables                                                                               |
| 25          | TFT Retail                                    | Added water tint                                                                                       |
| 26          | 1.31.0.12071: ROC-ROC multi and TFT-TFT multi | Added script lang switch, (Unconfirmed: changed how game data set version was treated between ROC/TFT) |
| 27          | 1.31.0.12071: TFT-TFT multi                   | Added game version: A.B.C.D, 1.32.3.4567                                                               |
| 28          | 1.31.?                                        | Moved scripting language switch                                                                        |
| 29          |                                               | Added graphics modes                                                                                   |
| 30          |                                               | Added game data version (TFT or ROC)                                                                   |
| 31          | 1.32                                          | Added player: enemy priority low/high                                                                  |
